<!-- Right side column. Contains the navbar and content of the page -->
<style>
    .onhoverfile:hover>.hovertextfile {
        display: block;
        position: absolute;
        background: #000;
        color: #fff;
        padding: 7px;
        border-radius: 4px;
        /* top: 0; */
        /* left: 62%; */
        z-index: 10;
        min-width: 329px;
        text-align: left;
    }

    .hovertextfile {
        display: none;
    }

    td.onhoverfile {
        position: relative;
    }
    .hovercolorText:hover {
        color: #20530E;
    }
    @media (max-width: 767px) {
    /* Hide the 'Show X entries' dropdown */
    .dataTables_length {
        display: none !important;
    }

    /* Align the search bar to the left and reduce its size */
    .dataTables_filter {
        margin-right: 15px; /* Optional space between search and other elements */
        width: 100%; /* Take full width */
        display: flex;
        justify-content: end;
        align-items: center;
    }

    .dataTables_filter label {
        width: 35% !important;  /* Make the search input take full width */
        font-size: 14px;  /* Optional: adjust font size */
        box-sizing: border-box;  /* Ensure padding doesn't overflow the input */
        float: right; /* Move the search bar to the right */
        text-align: right; /* Align text inside the search bar */
    }
    .dataTables_filter label input{
        width: 60%;
    }

    /* Align the pagination to the right */
    .dataTables_paginate {
        float: right;
        display: none !important;
    }

    /* Hide the 'Showing 1 to 1 of 1 entries' text */
    .dataTables_info {
        display: none !important;
    }
    .table-responsive{
        border: none !important;
    }
}
</style>



<aside class="right-side" style="padding-top: 50px;">
    <!-- Content Header (Page header) -->
    <section class="content-header row" style="margin: 0; padding-top: 0px; margin-top: 10px;">
        <!-- <h1 class="hidden-xs">Receive Invoice &nbsp;&nbsp; <span style="color: red;"> (! Please click the "Confirm Invoice" checkbox to let us know you have received our invoice.) </span></h1> -->
        <!-- <h1 class="hidden-xs col-sm-2">Receive Invoice</h1> -->

        <div class="col-sm-12 hidden-xs" style="width: 100%;">
            <span class="row" style="margin: 0; display: flex; gap: 5px;width: 100%;">

                <!-- <span class="col-md-3 col-xs-6" style="cursor: pointer;" id="viewAllInvoiceButton">
                    <span style="font-size: calc(46% + 16px);color: #238C00;">
                        <span class="badge"
                            style="background: #238C00;border-radius: 12%; font-size: 15px;padding: 6px 9px;">
                            <?php echo countTableFiltered("invoice","clintid",$lia['clientid']); ?>
                        </span>
                        <span class="hovercolorText">View All Invoice</span>
                    </span>
                </span> -->

                <!-- <span class="col-md-3 col-xs-6" style="cursor: pointer;" id="unpaid_invoice">
                    <span style="font-size: calc(46% + 16px);color: red;">
                        <span class="badge" style="background: red;border-radius: 12%; font-size: 15px;padding: 6px 9px;">
                            <?php echo countwithcondition('invoice','balance','>','0','clintid','=',$lia['clientid']); ?>
                        </span>
                        <span class="hovercolorText"> Invoice to pay</span>
                    </span>
                </span> -->

                <span class="col-md-2 col-xs-6" style="background-color: #000000; font-size: 17px; border-radius: 5px; text-align: left; padding: 5px 10px; display: flex; align-items: center; gap: 8px; width: 20%;">
                    <span style="height: 100%; display: inline-block; padding-top: 10px;"><i class="fa fa-list-ol" aria-hidden="true" style="color: orange; font-size: 40px;"></i></span>
                    <span style="color: white;">
                        Pls Confirm Received Invoice
                        <br>
                         Total Payable:<span style="color: yellow;"> <?php echo number_format(getTotalAmount('invoice','balance','clintid',$lia['clientid']));?></span>
                    </span>
                </span>

                <span class="col-md-8 col-xs-6" style="display: flex; justify-content: left; align-items: center; background-color: #00008E; color: white; margin-left: 12px; gap: 5px; border-radius: 5px; padding: 2px; padding-left: 10px; width: 70%;">
                    <span>
                        <i class="fa fa-exclamation-triangle" style="color: orange; font-size: 40px; margin-right: 10px;" aria-hidden="true"></i>
                    </span>
                    <span style="font-size: 17px; padding: 5px 0px;">
                        <?php
                        $filtered_invoice = 0;
                        foreach ($invoices as $invoice) { 
                            if($invoice['balance'] > 0 && $invoice['confirmed'] == 0){
                                $filtered_invoice++;
                            }
                         } 
                        ?>

                        We’ve attached the soft copy of the invoices listed below for your review. <br> Kindly verify the details of the
                        <span style="color: black; background-color: yellow; height: 25px; width: 25px; display: inline-block; text-align: center; border-radius: 3px;"><?php echo $filtered_invoice; ?></span>
                        invoices, confirm they are correct by ticking the box, and proceed with payment. The actual invoice will follow.
                    </span>

                </span>
                <span class="col-md-1 col-xs-6" style="background-color: #008622; display: flex;  justify-content: left; align-items: center;gap: 10px; border-radius: 5px;width: 10%;">
                    <a href="?route=complain_to_manger" style="display: flex;  justify-content: left; align-items: center;gap: 10px; cursor: pointer;">
                        <span style="font-size: 17px; text-align: center;">
                            <i class="fa fa-question-circle" aria-hidden="true" style="color: orange; font-size: 40px;"></i>
                        </span>
                        <span style="font-size: 17px; color: white;">
                            Any Issue
                            <br>
                            Click Here
                        </span>
                    </a>
                </span>

                <!-- <span class="col-md-4 col-xs-6" id="balance_to_pay_btn">
                    <span class="badge badge-danger"style="background: #000000;border-radius: 12%; font-size: 19px;padding: 4px 9px;">₱</span>
                    <span style="font-size: calc(46% + 16px);color: #646473;">
                        <span class="hovercolorText">Balance to pay:</span>
                    </span>
                    <span class="t-number animated-number" style="font-size: calc(46% + 16px);color: red;">
                        <?php echo number_format(getTotalAmount('invoice','balance','clintid',$lia['clientid']));?>
                    </span>
                </span> -->

                <!-- <span class="col-md-2 col-xs-6">
                    <button class="btn btn-info" id="reset_filter">Reset Filter</button>
                </span> -->
            </span>
        </div>
        <!-- <div class="col-sm-2" style="display: flex; justify-content: end;">
            <ol class="breadcrumb" style="background: none; margin-bottom: 0px;">
                <li><a href="?route=dashboard"><i class="fa fa-dashboard"></i> Home</a></li>
                <li class="active">Receive Invoice</li>
            </ol>
        </div> -->

    </section>
    <!-- Main content -->
    <section class="content">
        <?php if(!empty($statusmessage)): ?>
        <div class="row">
            <div class='col-md-12'>
                <div class="alert alert-<?php print $statusmessage[" type"]; ?> alert-auto" role="alert">
                    <?php print $statusmessage["message"]; ?>
                </div>
            </div>
        </div>
        <?php endif; ?>
        <div class="row">
            <div class="col-xs-12">
                <div class="box box-default">
                    <div class="box-body">
                        <div class="tab-pane">
                            <!-- <span class="right badge badge-danger">New</span> -->
                           <!-- <div class="hidden-xs">
                                <span class="col-md-12 col-xs-12" style="color: red; font-size: 30px;"> (! Please click the "Confirm Invoice" checkbox to let us know you have received our invoice.) </span>
                            </div> -->

                            <!-- <div class="col-md-3 col-xs-12" style="margin-top: 10px;"></div> -->

                            <div class="clearfix"></div>
                            <div class="clearfix"></div>
                            <div class="clearfix"></div>
                            <!-- <div class="table-responsive"> -->
                                <?php 
                                if(!isset($_GET['files_to_upload_mb']) && !isset($_GET['unpaid_invoice_mb'])){ ?>   
                                <div class="AllinvoiceTableContainer">
                                    <table id="dataTablesFullDesc" class="table table-striped table-hover">
                                        <thead>
                                            <tr style="border-bottom: 3px solid #BABAC7;">
                                                <th class="text-center">Date</th>
                                                <th class="text-center" title="Invoice for" style="width: 4%;">Month</th>
                                                <!-- <th class="text-center"><i class="fa fa-eye"></i></th> -->
                                                <!-- <th class="text-center">Upload</th>
                                                <th class="text-center">2307</th> -->

                                                <th class="text-center" style="width: 1%;" title=" The checkmark indicates that the invoice is duplicated or need attention">Dup</th>
                                                <th class="text-center">INV Ref No</th>

                                                <th class="text-right" style="width: 8%;">Invoice No.</th>
                                                <th class="text-center" style="width: 5%;">Amount</th>
                                                <th class="text-center">Invoice File</th>
                                                <th class="text-right" style="width: 1%;">Balance</th>
                                                <th class="text-center" title="If you download the actual invoice, please ensure it is marked as confirmed">Confirm Invoice</th>
                                                <!-- <th class="text-center">Pay Type</th>
                                                <th class="text-center">Pay Ref No</th>
                                                <th class="text-center">G</th>
                                                <th class="text-center">Paid File</th>
                                                <th class="text-center">Tax</th>
                                                <th class="text-center">O.R No.</th>
                                                <th class="text-right">Paid Amt</th>
                                                <th class="text-center">OR File</th> -->
                                                <th class="text-center" style="width: 2%;">Paid</th>
                                                <th class="text-center" style="width: 8%;">To Do</th>
                                                <th class="text-center" style="width: 12%;">Remarks</th>
    
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <?php foreach ($invoices as $invoice) { 
                                                $is_duplicate = check_dup_invoice($invoices , $invoice['ref_no'] , $invoice['clintid'] , $invoice['month'] , $invoice['id'] , $invoice['date']);
                                            if($is_duplicate){
                                                    $dup_html = "<span style='background-color: red; display: flex;width: 16px;height: 16px; margin: auto;'>
                                                        <svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='white' class='bi bi-check' viewBox='0 0 16 16'>
                                                            <path d='M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z'/>
                                                          </svg>
                                                    </span>";
                                            }else{
                                                    $dup_html = "<span style='background-color: lightgray; display: flex;width: 16px; height: 16px;margin: auto;'>&nbsp;</span>";
                                            }
                                                ?>
                                            <tr>
                                                <td style="text-align: center;">
                                                    <?php echo date('Y-m-d',strtotime($invoice['date'])); ?>
                                                </td>
                                                <?php 
                                                $month_name = "";
                                                if($invoice['month']==1) {
                                                    $month_name = "Jan";
                                                } elseif($invoice['month']==2) {
                                                    $month_name = "Feb";
                                                } elseif($invoice['month']==3) {
                                                    $month_name = "Mar";
                                                }  elseif($invoice['month']==4) {
                                                    $month_name = "Apr";
                                                }  elseif($invoice['month']==5) {
                                                    $month_name = "May";
                                                }  elseif($invoice['month']==6) {
                                                    $month_name = "Jun";
                                                } elseif($invoice['month']==7) {
                                                    $month_name = "Jul";
                                                } elseif($invoice['month']==8) {
                                                    $month_name = "Aug";
                                                } elseif($invoice['month']==9) {
                                                    $month_name = "Sep";
                                                } elseif($invoice['month']==10) {
                                                    $month_name = "Oct";
                                                } elseif($invoice['month']==11) {
                                                    $month_name = "Nov";
                                                } elseif($invoice['month']==11) {
                                                    $month_name = "Dec";
                                                } 
                                            ?>
                                                <td class="text-center">
                                                    <?php echo $month_name; ?></a>
                                                </td>
                                                <!-- <td class="text-center">
                                                   <a href='javascript:void(0);'
                                                       style="font-size: 15px;padding-right: 20px;"
                                                       onClick='window.open("?route=invoiceTPdf&id=<?php echo $invoice['clintid']; ?>&invoice_id=<?php echo $invoice['id']; ?>", "_blank")'>
                                                       <i class="fa fa-picture-o" aria-hidden="true"></i>
                                                   </a>
                                                </td> -->
    
                                                <?php
                                                    $invo_tax = '';
                                                    $targetfile = "uploads" . DIRECTORY_SEPARATOR . "tax_file". DIRECTORY_SEPARATOR . $invoice['tax_file_2307'];
                                                    
                                                    if($invoice['tax_file_2307'] != '') {
                                                    $invo_tax = "<a class='onhoverfile' style='font-size: 15px;padding-right: 15px;' href='$targetfile' target='_blank'><i class='fa fa-picture-o' aria-hidden='true'></i><span class='hovertextfile'>" . $invoice['tax_file_2307'] . "</span></a><br>";
                                                    
                                                    }
                                                ?>
    
                                                <!-- <td class="text-center" style="padding-right: 15px;">
                                                    <div style="display: flex;justify-content: space-evenly;">
                                                       
                                                        <?php if ($invoice['tax_file_2307']) { ?>
                                                         <a style='padding: 2px 7px;background-color: #B9B9C8;color: white;' data-toggle='tooltip' title='Upload Withholding Tax Document' class="btn btn-sm" href="#" onClick='showM("ajax.php?modal=taxfile&id=<?php echo $invoice['id']; ?>");return false;'>Re-Upload</a>
                                                        <?php } else { ?>
                                                       <a style='padding: 2px 10px;' data-toggle='tooltip' title='Upload Withholding Tax Document' class="btn btn-primary btn-sm" href="#" onClick='showM("ajax.php?modal=taxfile&id=<?php echo $invoice['id']; ?>");return false;'> Add 2307</a>
                                                        <?php } ?>
                                                    </div>

                                                </td>
    
                                                <td class="text-center" style="padding-right: 15px;">
                                                    <?php echo $invo_tax; ?>
                                                </td> -->

                                                <td class="text-center"><?php echo $dup_html; ?></td>

                                                <td class="text-center"><?php echo $invoice['ref_no']; ?></td>

                                                <td style="text-align: right;padding-right: 15px;">
                                                    <?php echo $invoice['invoiceno']; ?>
                                                </td>

                                                <td style="text-align: right;padding-right: 15px;">
                                                    <?php echo number_format($invoice['amount'], 2, '.', ','); ?>
                                                </td>

                                                <?php
                                                $invo = '';
                                                $targetfile = "uploads" . DIRECTORY_SEPARATOR . $invoice['attachment'];

                                                if (!empty($invoice['attachment'])) {
                                                    $invo = "<a class='onhoverfile' style='font-size: 15px;' href='$targetfile' target='_blank'><i class='fa fa-picture-o' aria-hidden='true' style='color: orange;'></i><span class='hovertextfile'>" . $invoice['attachment'] . "</span></a>&nbsp;";
                                                }
                                                ?>

                                                <td class="text-right" style="padding-right: 15px;">
                                                <a title="System Generated Invoice" href='javascript:void(0);'
                                                    style="font-size: 15px;padding-right: 5px;"
                                                    onClick='window.open("?route=invoiceTPdf&id=<?php echo $invoice['clintid']; ?>&invoice_id=<?php echo $invoice['id']; ?>", "_blank")'>
                                                    <i class="fa fa-picture-o" aria-hidden="true"></i>
                                                </a>
                                                <?php echo $invo; ?>
                                                </td>

                                                <td style="text-align: right;">
                                                    <?php echo number_format($invoice['balance'], 2, '.', ','); ?>
                                                </td>

                                                <td class="text-center confirm_td" style="padding-right: 15px;" id="confirm_td">
                                                    <?php 
                                                    if($invoice['confirmed'] == '1'){
                                                        $confirmed_html = '<label for="confirmed" style="margin-right: 5px;padding: 2px 20px; background-color: #BFBFCA; color: white;" >Confirmed</label><input type="checkbox" id="confirmed" class="confirmed" data-invoice_id="'.$invoice['id'].'" checked>';
                                                        echo $confirmed_html;
                                                    }else{
                                                        $confirmed_html = '<span style="background-color: red; padding: 5px; border-radius: 4px;"><label for="confirmed" style="margin-right: 5px; padding: 5px; color: white; " >Confirm</label><input type="checkbox" id="confirmed" class="confirmed" data-invoice_id="'.$invoice['id'].'" ></span>';
                                                        echo $confirmed_html;
                                                    }
                                                    ?>
                                                </td>
                                             
                                                <!-- <td>
                                                    <?php echo $invoice['payment_method']; ?>
                                                </td>

                                                <td title="Payment Detail" class="text-right" id="payment_ref_no_td" style="color: blue; cursor: pointer;" data-invoice_id="<?php echo $invoice['id']; ?>"><?php echo $invoice['payment_ref_no']; ?></td>

                                                <td title="This Payment is Part of a Larger Payment Applied Across Multiple Invoices" class="text-center">
                                                    <?php
                                                        if($invoice['multiple_payment'] == 1){
                                                            echo "M";
                                                        }
                                                    ?>
                                                </td>

                                                <?php
                                                $invo_paid = '';
                                                $targetfile = "uploads" . DIRECTORY_SEPARATOR . $invoice['paid_file'];

                                                if (!empty($invoice['paid_file'])) {
                                                    $invo_paid = "<a class='onhoverfile' style='font-size: 15px;padding-right: 15px;' href='$targetfile' target='_blank'><i class='fa fa-picture-o' aria-hidden='true'></i><span class='hovertextfile'>" . $invoice['paid_file'] . "</span></a><br>";
                                                }
                                                ?>
    
                                                <td class="text-center" style="padding-right: 15px;">
                                                    <?php echo $invo_paid?>
                                                </td>
                                                <td style="text-align: right;">
                                                    <?php echo $invoice['tax_amount']?>
                                                </td>
    
                                                <td style="text-align: right;">
                                                    <?php echo $invoice['ornumber']?>
                                                </td>
                                                <td style="text-align: right;">
                                                    <?php echo number_format($invoice['paid'], 2, '.', ','); ?>
                                                </td>

                                                <?php
                                                $invo_or = '';
                                                $targetfile = "uploads" . DIRECTORY_SEPARATOR . $invoice['or_file'];

                                                if (!empty($invoice['or_file'])) {
                                                    $invo_or = "<a class='onhoverfile' style='font-size: 15px;padding-right: 15px;' href='$targetfile' target='_blank'><i class='fa fa-picture-o' aria-hidden='true'></i><span class='hovertextfile'>" . $invoice['or_file'] . "</span></a><br>";
                                                }
                                                ?>
                                                <td class="text-center" style="padding-right: 15px;">
                                                    <?php echo $invo_or?>
                                                </td> -->

                                                <td style="text-align: center;">
                                                    <?php if($invoice['balance'] > 0): ?>
                                                    <a style="background-color:red;color: white;padding: 3px;border-radius: 3px;">No</a>
                                                    <?php else: ?>
                                                    <a style="color:#ffffff;background-color:#CCCCCC;padding: 3px;border-radius: 3px;">Yes</a>
                                                    <?php endif; ?>
                                                </td>
                                                <td class="text-center">
                                                    <?php if(!empty($invoice['attachment'])) { ?>
                                                        Prepare Payment
                                                    <?php } elseif(!empty($invoice['paid_file'])){?>
                                                        Upload Tax File (2307)
                                                    <?php } else {?>
                                                        Wait for invoice
                                                    <?php } ?>
                                                </td>

                                                <td>
                                                    <?php echo $invoice['remark']?>
                                                </td>
    
                                            </tr>
                                            <?php } ?>
                                        </tbody>
                                    </table>
                                </div>
                                <?php } ?>

                                <?php
                                if(isset($_GET['files_to_upload_mb']) && $_GET['files_to_upload_mb'] == 2){ ?>
                                <div class="hidden-lg table-responsive">
                                    <?php
                                    $video_url_2 = get_user_guide_video_data('how_to_upload_2307_files' , 'video_url');
                                    $video_url = isset($video_url_2) ? $video_url_2 : '';
                                    ?>
                                    <span style="position: absolute; margin-left: 10px; font-size: 15px; z-index: 999;" class="youtube_image" data-url="<?php echo $video_url; ?>">
                                        How To Use <span><i class="fa fa-youtube-play" style="margin-left: 5px; color: red; font-size: 21px;"></i></span>
                                    </span>

                                    <table  id="dataTablesFullDesc" class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th class="text-center">Upload</th>
                                                <th class="text-right">INV No.</th>
                                                <th class="text-center">INV Amt</th>
                                                <th class="text-right">Paid Amt</th>
                                                <th class="text-center">INV File</th>
                                                <th class="text-center">OR File</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <?php foreach ($invoices as $invoice) { ?>
                                                <tr>
                                                    <td class="text-center" style="padding-right: 15px;">
                                                        <div style="display: flex;justify-content: space-evenly;">
                                                           
                                                            <?php if ($invoice['tax_file_2307']) { ?>
                                                             <a style='padding: 2px 7px;background-color: #B9B9C8;color: white;' data-toggle='tooltip' title='Upload Withholding Tax Document' class="btn btn-sm" href="#" onClick='showM("ajax.php?modal=taxfile&id=<?php echo $invoice['id']; ?>");return false;'>Re-Upload</a>
                                                            <?php } else { ?>
                                                           <a style='padding: 2px 10px;' data-toggle='tooltip' title='Upload Withholding Tax Document' class="btn btn-primary btn-sm" href="#" onClick='showM("ajax.php?modal=taxfile&id=<?php echo $invoice['id']; ?>");return false;'> Add 2307</a>
                                                            <?php } ?>
                                                        </div>
                                                    </td>
                                                    <td style="text-align: right;padding-right: 15px;">
                                                        <?php echo $invoice['invoiceno']?>
                                                    </td>
                                                       <td style="text-align: right;padding-right: 15px;">
                                                        <?php echo number_format($invoice['amount'], 0, '.', ','); ?>
                                                    </td>
                                                    
                                                      <?php
                                                    $invo = '';
                                                    $targetfile = "uploads" . DIRECTORY_SEPARATOR . $invoice['attachment'];
    
                                                    if (!empty($invoice['attachment'])) {
                                                        $invo = "<a class='onhoverfile' style='font-size: 15px;padding-right: 15px;' href='$targetfile' target='_blank'><i class='fa fa-picture-o' aria-hidden='true'></i><span class='hovertextfile'>" . $invoice['attachment'] . "</span></a><br>";
                                                    }
                                                    ?>
                                                    <td style="text-align: right;">
                                                        <?php echo number_format($invoice['paid'], 0, '.', ','); ?>
                                                    </td>
                                                    
                                                    <td class="text-center" style="padding-right: 15px;">
                                                        <?php echo $invo?>
                                                    </td>
                                                    
                                                  
    
                                                    <?php
                                                    $invo_or = '';
                                                    $targetfile = "uploads" . DIRECTORY_SEPARATOR . $invoice['or_file'];
    
                                                    if (!empty($invoice['or_file'])) {
                                                        $invo_or = "<a class='onhoverfile' style='font-size: 15px;padding-right: 15px;' href='$targetfile' target='_blank'><i class='fa fa-picture-o' aria-hidden='true'></i><span class='hovertextfile'>" . $invoice['or_file'] . "</span></a><br>";
                                                    }
                                                    ?>
                                                    <td class="text-center" style="padding-right: 15px;">
                                                        <?php echo $invo_or?>
                                                    </td>
                                                </tr>
                                            <?php } ?>
                                        </tbody>
                                    </table>
                                </div>
                                <?php }
                                 ?>

                                 <?php 
                                 if(isset($_GET['unpaid_invoice_mb']) && $_GET['unpaid_invoice_mb'] == 2){ ?>
                                 <div class="hidden-lg table-responsive">
                                     <table  id="dataTablesFullDesc" class="table table-striped table-hover">
                                         <thead>
                                             <tr>
                                                 <th class="text-center">For</th>
                                                 <th class="text-center"><i class="fa fa-eye"></i></th>
                                                 <th class="text-right">INV No.</th>
                                                 <th class="text-center">INV Amt</th>
                                                 <th class="text-center">INV File</th>
                                             </tr>
                                         </thead>
                                         <tbody>
                                             <?php foreach ($invoices as $invoice) { ?>
                                                 <tr>
                                                        <?php 
                                                        $month_name = "";
                                                        if($invoice['month']==1) {
                                                            $month_name = "Jan";
                                                        } elseif($invoice['month']==2) {
                                                            $month_name = "Feb";
                                                        } elseif($invoice['month']==3) {
                                                            $month_name = "Mar";
                                                        }  elseif($invoice['month']==4) {
                                                            $month_name = "Apr";
                                                        }  elseif($invoice['month']==5) {
                                                            $month_name = "May";
                                                        }  elseif($invoice['month']==6) {
                                                            $month_name = "Jun";
                                                        } elseif($invoice['month']==7) {
                                                            $month_name = "Jul";
                                                        } elseif($invoice['month']==8) {
                                                            $month_name = "Aug";
                                                        } elseif($invoice['month']==9) {
                                                            $month_name = "Sep";
                                                        } elseif($invoice['month']==10) {
                                                            $month_name = "Oct";
                                                        } elseif($invoice['month']==11) {
                                                            $month_name = "Nov";
                                                        } elseif($invoice['month']==11) {
                                                            $month_name = "Dec";
                                                        } 
                                                    ?>
                                                    <td class="text-center">
                                                        <?php echo $month_name; ?></a>
                                                    </td>
                                                    <td class="text-center">
    
                                                        <a href='javascript:void(0);'
                                                            style="font-size: 15px;padding-right: 20px;"
                                                            onClick='window.open("?route=invoiceTPdf&id=<?php echo $invoice['clintid']; ?>&invoice_id=<?php echo $invoice['id']; ?>", "_blank")'>
                                                            <i class="fa fa-picture-o" aria-hidden="true"></i>
                                                         </a>
     
                                                     </td>
                                                     <td style="text-align: right;padding-right: 15px;">
                                                         <?php echo $invoice['invoiceno']?>
                                                     </td>
                                                        <td style="text-align: right;padding-right: 15px;">
                                                         <?php echo number_format($invoice['amount'], 0, '.', ','); ?>
                                                     </td>
                                                     
                                                       <?php
                                                     $invo = '';
                                                     $targetfile = "uploads" . DIRECTORY_SEPARATOR . $invoice['attachment'];
     
                                                     if (!empty($invoice['attachment'])) {
                                                         $invo = "<a class='onhoverfile' style='font-size: 15px;padding-right: 15px;' href='$targetfile' target='_blank'><i class='fa fa-picture-o' aria-hidden='true'></i><span class='hovertextfile'>" . $invoice['attachment'] . "</span></a><br>";
                                                     }
                                                     ?>
     
                                                     
                                                     <td class="text-center" style="padding-right: 15px;">
                                                         <?php echo $invo?>
                                                     </td>
                                                 </tr>
                                             <?php } ?>
                                         </tbody>
                                     </table>
                                 </div>
                                 <?php }
                                  ?>


                                  <div class="modal fade" id="myModalyoutube" tabindex="-1" role="dialog">
                                    <form role="form" method="post" enctype="multipart/form-data" style="height: 100%;">
                                        <div class="modal-dialog modal-center">
                                            <div class="modal-content" style="width: 100%;">
                                                <button style="margin: 0px 6px 0 0px; font-size: 32px;" type="button" class="close close-second-modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                                <iframe style="padding: 0 15px 15px 15px;" id="myIframe" width="100%" height="350" frameborder="0" allowfullscreen></iframe>
                                            </div>
                                        </div>
                                    </form>
                                </div>



                                <div class="modal fade" id="bulk_invoice_payment_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                                aria-hidden="true">
                                    <div class="modal-dialog modal-lg" role="document">
                                        <div class="modal-content">
                                            <form action="" method="post" role="form" id="bulk_invoice_payment" onsubmit="return false;">
                                                <input type="hidden" name="bulk_invoice_payment">
                                                <div class="modal-header">
                                                    <h4 style="display: inline;">Invoice Payment</h4>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="payment_detail row" style="text-align: center;">
                                                        <div class="col-sm-8">
                                                            <table class="table table-striped table-hover">
                                                                <thead>
                                                                    <tr>
                                                                        <th><input type="checkbox" id="checkall_inv"></th>
                                                                        <th>Date</th>
                                                                        <th>D</th>
                                                                        <th>M</th>
                                                                        <th>INV Ref No</th>
                                                                        <th>Client</th>
                                                                        <th>INV</th>
                                                                        <th>AMT</th>
                                                                        <th>INV File</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody class="bulk_invoice_payment_info_tbody"></tbody>
                                                            </table>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <!-- form element -->
                                                            <div class="form-group" style="margin-bottom: 0px;">
                                                                <label for="payment_method" style="text-align: left; width: 100%;" class="control-label">Payment Method</label>
                                                                <input type="text" id="payment_method_info" class="form-control" style="width:100%;display:inline;" readonly>
                                                            </div>
                                                            
                                                            <div class="form-group" style="margin-bottom: 0px;">
                                                                <label for="payment_ref_no" style="text-align: left; width: 100%;" class="control-label">Payment Ref No</label>
                                                                <div>
                                                                    <input type="text" class="form-control" id="payment_ref_no_info" readonly>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="form-group" style="margin-bottom: 0px;">
                                                                <label class="control-label" style="text-align: left; width: 100%;">O.R Number</label>
                                                                <div>
                                                                    <input type="text" class="form-control" id="ornumber_info" readonly>
                                                                </div>
                                                            </div>
                                
                                                            <div class="form-group" style="margin-bottom: 0px;">
                                                                <label for="paid" class="control-label" style="width: 100%; text-align: left;">
                                                                    <span style="font-size: 16px; ">Invoice Amount : <span style="color: red;" id="invoice_amt_modal_info"></span> </span><br>
                                                                    Received Amount 
                                                                </label>
                                                                <div>
                                                                    <input type="text" class="form-control" id="paid_info" readonly>
                                                                </div>
                                                            </div>
                                
                                                            <div style="width: 100%; text-align: left;">
                                                                <input type="hidden" id="tax" name="tax">
                                                                <span style="font-size: 17px;"> 2037 Balance or Discount : <span id="total_tax_info" style="color: red;"></span> </span>
                                                            </div>
                                                            <div id="invoice_check_error"></div>
                                
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                    <button type="submit" class="btn btn-primary" id="save_bulk_btn">Save changes</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section><!-- /.content -->
</aside><!-- /.right-side -->

     <script>
    $(document).ready(function() {

        setTimeout(function(){
            $("#dataTablesFullDesc_length").css('color' , '#DBDBEA');
            $("#dataTablesFullDesc_info").css('color' , '#DBDBEA');
        } , 1000);

        $(document).on("click", "#payment_ref_no_td", function () {
        let payment_ref_no_td = $(this).text().trim(); // Get the text inside the td
        
        if (payment_ref_no_td !== '') {
            var invoice_id = $(this).data('invoice_id');
            $.ajax({
            url: "ajax.php?get_invoice_by_invoice_id=''",
            data : {
                'invoice_id' : invoice_id
            },
            type : "POST",
            success: function(res){
            var data = JSON.parse(res);
                if (data.res ?.status == 1) {
                    var invoice = data.res ?.data;
                    $(".payment_detail #paid_info").val(invoice.paid);
                    $(".payment_detail #payment_ref_no_info").val(invoice.payment_ref_no);
                    $(".payment_detail #ornumber_info").val(invoice.ornumber);
                    $(".payment_detail #payment_method_info").val(invoice.payment_method_info);
                    $(".invoice_modal_body").hide();
                    $(".paid_msg").hide();
                    $(".payment_detail").show();
                    $("#save_bulk_btn").hide();
                    $(".bulk_invoice_payment_info_tbody").html(data.res ?.tbody);
                    var totle_amount = data.res ?.totle_amount;
                    $("#invoice_amt_modal_info").html(totle_amount.toLocaleString("en-US"));
                    var discount = totle_amount - invoice.paid;
                    $("#total_tax_info").html(discount);
                    $("#bulk_invoice_payment_modal").modal('show');
                }
            }
        })
        }
    });

        // $("#viewAllInvoiceButton").click(function() {
        //     $(".AllinvoiceTableContainer").show();
        //     $(".pendingTableContainer").hide();
        //     $(".unpaidTableContainer").hide();
        //     $(".tofollowTableContainer").hide();
        // });

        // $("#unpaid_invoice").click(function() {
        //     $(".AllinvoiceTableContainer").hide();
        //     $(".pendingTableContainer").hide();
        //     $(".unpaidTableContainer").show();
        //     $(".tofollowTableContainer").hide();
        // });

        // $("#view_pending_tax_file").click(function() {
        //     $(".AllinvoiceTableContainer").hide();
        //     $(".unpaidTableContainer").hide();
        //     $(".pendingTableContainer").show();
        //     $(".tofollowTableContainer").hide();
        // });

        // $("#view_follow_up").click(function() {
        //     $(".AllinvoiceTableContainer").hide();
        //     $(".unpaidTableContainer").hide();
        //     $(".pendingTableContainer").hide();
        //     $(".tofollowTableContainer").show();
        // });

        // $("#viewAllInvoiceButtonsm").click(function() {
        //     $(".AllinvoiceTableContainer").show();
        //     $(".pendingTableContainer").hide();
        //     $(".unpaidTableContainer").hide();
        //     $(".tofollowTableContainer").hide();
        // });

        // $("#unpaid_invoicesm").click(function() {
        //     $(".AllinvoiceTableContainer").hide();
        //     $(".pendingTableContainer").hide();
        //     $(".unpaidTableContainer").show();
        //     $(".tofollowTableContainer").hide();
        // });

        // $("#view_pending_tax_filesm").click(function() {
        //     $(".AllinvoiceTableContainer").hide();
        //     $(".unpaidTableContainer").hide();
        //     $(".pendingTableContainer").show();
        //     $(".tofollowTableContainer").hide();
        // });

        // $("#view_follow_upm").click(function() {
        //     $(".tofollowTableContainer").show();
        //     $(".AllinvoiceTableContainer").hide();
        //     $(".pendingTableContainer").hide();
        //     $(".unpaidTableContainer").hide();
        // });


        $("#files_to_upload_table").dataTable( { "order": [[ 0, "desc" ]],"pageLength": <?php echo getConfigValue("table_records"); ?>, "dom": '<"top"f>rt<"bottom"><"row dt-margin"<"col-md-6"i><"col-md-6"p>><"clear">', "oLanguage": { "sSearch": "" }, "columnDefs": [ { "orderable": false, "targets": -1 } ] } );

    $("#viewAllInvoiceButton").click(function (e) {
        var url = new URL(window.location.href); // Get the current URL
        var searchParams = url.searchParams; // Access the query parameters

        // Check if 'paid' parameter is already in the URL
        if (searchParams.has('paid')) {
            searchParams.delete('paid');
        } 
        if (searchParams.has('unpaid_invoice_filter')) {
            searchParams.delete('unpaid_invoice_filter');
        } 
        if (searchParams.has('view_pending_tax_filter')) {
            searchParams.delete('view_pending_tax_filter');
        } 

        if (searchParams.has('unpaid_invoice')) {
            searchParams.delete('unpaid_invoice');
        } 

        if (searchParams.has('files_to_upload')) {
            searchParams.delete('files_to_upload');
        } 

        if (searchParams.has('files_to_upload_mb')) {
            searchParams.delete('files_to_upload_mb');
        } 

        if (searchParams.has('unpaid_invoice_mb')) {
            searchParams.delete('unpaid_invoice_mb');
        }     

        

        window.location.href = url;
        var table = $('#dataTablesFullDesc').DataTable();
        $.fn.dataTable.ext.search = [];
        table.draw();
    });

    $("#reset_filter").click(function (e) {
        var table = $('#dataTablesFullDesc').DataTable();
        $.fn.dataTable.ext.search = [];
        table.draw();
    });

// dhaval
    let table;
    if (!$.fn.DataTable.isDataTable('#dataTablesFullDesc')) {
        table = $('#dataTablesFullDesc').DataTable({
            destroy: true,
            autoWidth: false,
        });
    } else {
        table = $('#dataTablesFullDesc').DataTable();
    }

    // Capture DataTable errors
    // don't dilete this thing 
    $.fn.dataTable.ext.errMode = function (settings, helpPage, message) {};

    $("#unpaid_invoice").click(function () {


        var url = new URL(window.location.href); // Get the current URL
        var searchParams = url.searchParams; // Access the query parameters
        if (searchParams.has('unpaid_invoice_filter')) {
            searchParams.delete('unpaid_invoice_filter');
        }

        if (searchParams.has('view_pending_tax_filter')) {
            searchParams.delete('view_pending_tax_filter');
        }

        if (searchParams.has('unpaid_invoice')) {
            searchParams.delete('unpaid_invoice');
        } 

        if (searchParams.has('files_to_upload')) {
            searchParams.delete('files_to_upload');
        } 
        if (searchParams.has('files_to_upload_mb')) {
            searchParams.delete('files_to_upload_mb');
        } 

        if (searchParams.has('unpaid_invoice_mb')) {
            searchParams.delete('unpaid_invoice_mb');
        }
          // Check if 'paid' parameter is already in the URL
    if (searchParams.has('paid')) {
        // If 'paid' exists, remove it and reload the page
        searchParams.delete('paid');
    }
    url = url+'&unpaid_invoice_filter=1'
    window.location.href = url

        // Debugging column data
      // Apply the filter
    });

    $("#view_pending_tax_file").click(function (e) {
        var url = new URL(window.location.href); // Get the current URL
        var searchParams = url.searchParams; // Access the query parameters

          // Check if 'paid' parameter is already in the URL

            if (searchParams.has('unpaid_invoice_filter')) {
                searchParams.delete('unpaid_invoice_filter');
            } 
            if (searchParams.has('paid')) {
                searchParams.delete('paid');    
            } 

            if (searchParams.has('unpaid_invoice')) {
            searchParams.delete('unpaid_invoice');
        } 

        if (searchParams.has('files_to_upload')) {
            searchParams.delete('files_to_upload');
        } 
        if (searchParams.has('view_pending_tax_filter')) {
            searchParams.delete('view_pending_tax_filter');
        } 
        if (searchParams.has('files_to_upload_mb')) {
            searchParams.delete('files_to_upload_mb');
        } 

        if (searchParams.has('unpaid_invoice_mb')) {
            searchParams.delete('unpaid_invoice_mb');
        }

        window.location.href = url + '&view_pending_tax_filter=1';

    });

    const url = new URL(window.location.href);
    const unpaidInvoice = url.searchParams.get("unpaid_invoice");
    const unpaid_invoice_mb = url.searchParams.get("unpaid_invoice_mb");

    const files_to_upload = url.searchParams.get("files_to_upload");
    const files_to_upload_mb = url.searchParams.get("files_to_upload_mb");
    const unpaid_invoice_filter = url.searchParams.get("unpaid_invoice_filter");
    const view_pending_tax_filter = url.searchParams.get("view_pending_tax_filter");
    const paid = url.searchParams.get("paid")
    
    if (unpaidInvoice === "1") {
            if ($.fn.DataTable.isDataTable('#files_to_upload_table')) {
                    if ($.fn.DataTable.isDataTable('#files_to_upload_table')) {
                            $.fn.dataTable.ext.search = [];
                    $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
                        const balance = parseFloat(data[16]); // Extract 16th column
                        return balance > 0;
                    });

                table.draw();
            }
            }
    }

    
    if (unpaid_invoice_mb == "2") {
            if ($.fn.DataTable.isDataTable('#files_to_upload_table')) {
                    if ($.fn.DataTable.isDataTable('#files_to_upload_table')) {
                            $.fn.dataTable.ext.search = [];
                    $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
                        const balance = parseFloat(data[16]); // Extract 16th column
                        return balance > 0;
                    });

                table.draw();
            }
            }
    }

    if (files_to_upload === "1") {
            if ($.fn.DataTable.isDataTable('#files_to_upload_table')) {
                $.fn.dataTable.ext.search = [];

                $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
                    var balance = parseFloat(data[16]);
                    var taxFile = data[4];
                    if (balance > 0 && (taxFile === '' || taxFile === null)) {
                        return true;
                    }
                    return false;
                });

                table.draw();
            }
    }

    
    if (files_to_upload_mb == "2") {
            if ($.fn.DataTable.isDataTable('#files_to_upload_table')) {
                $.fn.dataTable.ext.search = [];

                $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
                    var balance = parseFloat(data[16]);
                    var taxFile = data[4];
                    if (balance > 0 && (taxFile === '' || taxFile === null)) {
                        return true;
                    }
                    return false;
                });

                table.draw();
            }
    }

    if (unpaid_invoice_filter === "1" || paid === "1") {

            if ($.fn.DataTable.isDataTable('#dataTablesFullDesc')) {
                        $.fn.dataTable.ext.search = [];
                $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
                    const balance = parseFloat(data[7]); // Extract 16th column
                    return balance > 0;
                });

            table.draw();
            }
    }

    if (view_pending_tax_filter === "1") {
            if ($.fn.DataTable.isDataTable('#dataTablesFullDesc')) {
                $.fn.dataTable.ext.search = [];

                $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
                    var balance = parseFloat(data[17]);
                    var taxFile = data[4];
                    if (balance > 0 && (taxFile === '' || taxFile === null)) {
                        return true;
                    }
                    return false;
                });

                table.draw();
            }


           
    }


// dhaval 
$("#balance_to_pay_btn").on('click' , function(){
    var url = new URL(window.location.href); // Get the current URL
    var searchParams = url.searchParams; // Access the query parameters
    if (searchParams.has('unpaid_invoice_filter')) {
        searchParams.delete('unpaid_invoice_filter');
    }

    if (searchParams.has('view_pending_tax_filter')) {
        searchParams.delete('view_pending_tax_filter');
    }

    if (searchParams.has('unpaid_invoice')) {
            searchParams.delete('unpaid_invoice');
        } 

        if (searchParams.has('files_to_upload')) {
            searchParams.delete('files_to_upload');
        } 
        if (searchParams.has('files_to_upload_mb')) {
            searchParams.delete('files_to_upload_mb');
        } 

        if (searchParams.has('unpaid_invoice_mb')) {
            searchParams.delete('unpaid_invoice_mb');
        }
    // Check if the 'paid' parameter is already in the URL
    if (!searchParams.has('paid')) {
        // If 'paid' is not in the URL, append it
        searchParams.append('paid', '1');
        window.location.href = url.toString(); // Redirect to the new URL with 'paid=1'
    }
})

    });

    $('.youtube_image').click(function () {
        var url = $(this).data('url');
        $('#myIframe').attr('src', url);
        $('#myModalyoutube').modal('show');
    });

    $(document).on('click', '.close-second-modal', function () {
        $('#myModalyoutube').modal('hide');
    });
    
    $(document).on("change" , ".confirmed" , function(){
        var invoice_id = $(this).data('invoice_id');
        var checkbox = $(this);
        var label = checkbox.prev('label');
        var parentTd = checkbox.closest('td'); // Get the parent <td> element
        if ($(this).is(":checked")) {
            $.ajax({
                url: "ajax.php?update_invoice_confirm=1",
                data : {
                    'invoice_id' : invoice_id
                },
                type : "POST",
                success: function(res){
                    // label.html('Confirmed');
                    parentTd.html('');
                    parentTd.html('<label for="confirmed" style="margin-right: 5px;padding: 2px 20px; background-color: #BFBFCA; color: white;" >Confirmed</label><input type="checkbox" id="confirmed" class="confirmed" data-invoice_id="'+invoice_id+'" checked>');
                    
                }
            })
            // invoice_id
        }else{
            $.ajax({
                url: "ajax.php?update_invoice_confirm=0",
                data : {
                    'invoice_id' : invoice_id
                },
                type : "POST",
                success: function(res){
                    // label.html('Not Confirmed');

                    // $(".confirm_td").html('');
                    parentTd.html('');
                    parentTd.html('<span style="border-radius: 4px;background-color: red; padding: 5px;"><label for="confirmed" style="margin-right: 5px; padding: 5px; color: white; " >Confirm</label><input type="checkbox" id="confirmed" class="confirmed" data-invoice_id="'+invoice_id+'" ></span>');
                    

                    // 
                }
            })
        }  
    })


    
</script>

